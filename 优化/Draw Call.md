Draw call 是什么:就是CPU对GPU发出的渲染指令
Draw Call是一种在图形渲染过程中非常重要的概念，它告诉图形API（如DirectX或OpenGL）需要绘制什么以及如何绘制。每个Draw Call包含了图形API绘制屏幕所需的所有信息，例如纹理、着色器（Shader）和缓冲区（Buffers）等。Draw Call本身可以是资源密集型的，但通常准备Draw Call的过程比Draw Call本身更耗费资源。为了优化Draw Call，通常采取两种方法：减少总的Draw Call数量和组织Draw Call以减少渲染状态（Render State）变化的次数[1](https://docs.unity3d.com/Manual/optimizing-draw-calls.html#:~:text=A%20draw%20call%20tells%20the,See%20in%20Glossary%2C%20and%20buffers.)。

Draw Call的优化非常关键，因为它直接影响到游戏或应用程序的性能。优化Draw Call的主要目标是减少渲染状态变化的次数，因为这些变化是最耗费资源的操作之一。通过减少Draw Call的数量或组织Draw Call以减少渲染状态变化，可以显著提高性能[1](https://docs.unity3d.com/Manual/optimizing-draw-calls.html#:~:text=A%20draw%20call%20tells%20the,See%20in%20Glossary%2C%20and%20buffers.)。

现代图形API，如Mantle、Vulkan和Direct3D12，专注于优化Draw Call处理，减少API开销，并允许更多的Draw Call在同一时间内被处理。这意味着CPU准备数据给GPU的工作已经得到了显著改善，较慢的CPU现在可以处理更多的Draw Call，从而提高整体性能[4](https://toncijukic.medium.com/draw-calls-in-a-nutshell-597330a85381)。

简而言之，Draw Call是图形渲染过程中的一个关键环节，它决定了如何将场景中的对象渲染到屏幕上。通过优化Draw Call的处理，可以显著提高图形渲染的效率和性能。

#为什么Drawcall消耗性能
1. 第一点在图形渲染过程中，CPU准备Draw Call的阶段通常是最耗时的部分。这是因为在这个阶段，CPU需要完成以下几个关键任务：

 **构建Draw Call**：CPU需要确定哪些对象需要被渲染，以及如何渲染它们。这包括选择正确的纹理、着色器和缓冲区等资源。

**设置渲染状态**：CPU还需要设置渲染状态，如光照模型、混合模式等，这些状态决定了如何将对象渲染到屏幕上。

 **提交Draw Call**：最后，CPU将准备好的Draw Call提交给GPU。这个过程可能涉及到上下文切换，从用户模式到内核模式，这也是一个相对耗时的操作。

由于这些任务的复杂性和需要的资源，CPU准备Draw Call的阶段往往是整个渲染管线中最耗时的部分。因此，优化这个阶段的性能变得尤为重要。例如，通过减少Draw Call的数量、批量处理多个Draw Call、使用命令缓冲区等技术，可以显著减少CPU准备Draw Call的时间，从而提高整体渲染性能。
2. 第二点命令从运行时（Runtime）到驱动程序（Driver）的过程中，需要进行从**用户模式**到**内核模式**的切换。这个过程涉及到操作系统级别的上下文切换，这在高频率的图形渲染中会成为一个显著的性能瓶颈。

当应用程序发起一个Draw Call时，它首先将命令发送到运行时环境。运行时环境负责将这些命令封装成适合驱动程序处理的格式，并将它们传递给相应的图形驱动程序。这个过程涉及到从用户空间到内核空间的上下文切换，因为驱动程序运行在内核空间，而应用程序运行在用户空间。这意味着操作系统需要保存当前进程的状态（包括寄存器值、程序计数器等），然后加载新的进程状态，以便驱动程序可以执行命令。

这种上下文切换不仅消耗了大量的时间，而且还导致了额外的开销，因为每次切换都需要重新加载和保存寄存器等资源。在高频率的图形渲染中，这种开销可能会累积，显著影响性能。

为了减少这种性能损失，有几种常见的优化策略：

- **批量处理**：尽可能地将多个Draw Call合并为一个批处理，这样可以减少上下文切换的次数。
- **命令缓冲区**：使用命令缓冲区来预先填充命令，然后一次性提交给驱动程序，这样可以减少上下文切换的次数。
- **异步命令处理**：允许驱动程序在后台异步处理命令，而不是立即响应，每个Draw Call。这需要驱动程序支持异步命令队列（ACQ）。
[[CPU 用户模式和内核模式]]
优化方法:  还没学会捏



